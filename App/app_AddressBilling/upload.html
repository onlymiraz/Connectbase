<!-- /App/app_AddressBilling/upload.html -->
{% extends "base.html" %}
{% block title %}Upload File{% endblock %}

{% block content %}
<div class="container">
  <!-- 1) Upload Card -->
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="pbi-card">
        <div class="pbi-header text-center">
          <h2 class="mb-0">Upload Address File</h2>
        </div>
        <div class="card-body">

          <!-- POST with spinner overlay for the actual file upload -->
          <form
            action="{{ url_for('upload') }}"
            method="post"
            enctype="multipart/form-data"
            onsubmit="showProcessingOverlay()"
          >
            <!-- Email -->
            <div class="mb-3 text-center">
              <label for="user_email" class="form-label">Enter Your Email:</label>
              <input
                type="email"
                class="form-control"
                id="user_email"
                name="user_email"
                required
                value="{{ session.get('user_email', '') }}"
              >
            </div>

            <!-- File -->
            <div class="mb-3 text-center">
              <label class="form-label">Select File:</label>
              <input
                type="file"
                class="form-control"
                name="file"
                accept=".xlsx,.xls,.csv,.txt"
                required
              >
            </div>

            <div class="text-center mt-3">
              <button type="submit" class="btn btn-primary">
                Upload
              </button>
            </div>
          </form>

          <hr />

          <!-- 2) Retrieve older data by batch_id -->
          <!-- Open in a new tab so the main page doesn't spin. -->
          <h5 class="text-center">Retrieve previously uploaded data:</h5>
          <form
            action="{{ url_for('get_batch_data') }}"
            method="post"
            target="_blank"
          >
            <div class="mb-3 text-center">
              <label for="batch_id" class="form-label">Enter Batch ID:</label>
              <input
                type="text"
                class="form-control"
                id="batch_id"
                name="batch_id"
                placeholder="e.g. a2345678-..."
                required
              >
            </div>
            <div class="text-center">
              <button type="submit" class="btn btn-secondary">
                Get Batch
              </button>
            </div>
          </form>

          <hr/>

          <!-- NEW: Button linking to the new batch history page. -->
          <div class="text-center">
            <a
              href="{{ url_for('batch_history') }}"
              class="btn btn-info"
            >
              All Batches (Pending &amp; Done)
            </a>
          </div>

        </div><!-- card-body -->
      </div><!-- pbi-card -->
    </div><!-- col -->
  </div><!-- row -->

  <!-- NEW: Buttons to generate PDF/Word/PPT docs about the system -->
  <div class="row mt-5">
    <div class="col-md-12 text-center">
      <h4>Generate Documentation</h4>
      <p class="text-muted mb-3">
        Click any button to download a dynamic doc (technical/business) about this Address Billing system.
      </p>
      <a href="{{ url_for('generate_documentation', doc_type='pdf') }}"
         class="btn btn-danger mb-2"
         target="_blank">
        Generate PDF
      </a>
      <a href="{{ url_for('generate_documentation', doc_type='docx') }}"
         class="btn btn-primary mb-2"
         target="_blank">
        Generate Word (DOCX)
      </a>
      <a href="{{ url_for('generate_documentation', doc_type='pptx') }}"
         class="btn btn-warning mb-2"
         target="_blank">
        Generate PowerPoint (PPTX)
      </a>
    </div>
  </div>
</div><!-- container -->

<!-- The upload spinner overlay -->
<div
  id="processing-overlay"
  style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
         background:rgba(0,0,0,0.5); z-index:9999; text-align:center; color:white;"
>
  <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);">
    <div class="spinner-border text-light" role="status" style="width:3rem; height:3rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
    <h3 class="mt-3">Please wait...</h3>
  </div>
</div>

<script>
function showProcessingOverlay() {
  // Only triggered on the file upload form
  document.getElementById('processing-overlay').style.display = 'block';
}
</script>
{% endblock %}

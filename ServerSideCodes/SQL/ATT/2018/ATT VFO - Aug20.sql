SELECT PON, MAX(INIT_AS) INIT_ASR, MAX(FIRST_CLEAN) FIRST_CLEAN, MAX(CLEAN_AS) CLEAN_ASR, MAX(INIT_CONF) INIT_CONF, MAX(CLEAN_CONF) CLEAN_CONF,
MAX(INIT_DLR) INIT_DLR, MAX(CLEAN_DLR) CLEAN_DLR
FROM(
--
SELECT PON, MIN(DT) INIT_AS, NULL FIRST_CLEAN, MAX(DT) CLEAN_AS, NULL INIT_CONF, NULL CLEAN_CONF, NULL INIT_DLR, NULL CLEAN_DLR
FROM (
SELECT PON, VERSION, ORDERSTATUS, TRUNC(CREATIONDATETIME) DT
FROM WHSL_ADV_HIST.VFO_ORDERHISTORYINFO_THIST ORD
WHERE PON IN (
'7WSC3858790',
'7WSC3858803',
'HWSV4483627',
'HWSV4483641',
'OF32150836E1N',
'HWSC3866515',
'7WSC3854309',
'7WSC3861855',
'HWSC3871324',
'GWS03873879',
'28091015-TSP',
'OF33766520E1U',
'OF33767313E2U',
'OF33767313E2UA',
'OF33952784E1',
'OF33766520E1UA',
'HWSV4525777',
'7WSC3877231',
'HWSC3877673',
'OF34200490E2U',
'OF34200490E1U',
'OF34203478E2',
'OF34203478E1',
'OF34201599E1U',
'OF34201599E2U'
)
AND ORDERSTATUS IN ('Accepted_Submitted')
)
GROUP BY PON
--
UNION ALL
--
SELECT PON, NULL INIT_AS, TRUNC(FIRST_CLEAN) FIRST_CLEAN, NULL CLEAN_AS, NULL INIT_CONF, NULL CLEAN_CONF, NULL INIT_DLR, NULL CLEAN_DLR
FROM (
--
SELECT SUBQ1.PON, CAST(MAX(VFO2.CREATIONDATETIME) AS DATE) AS FIRST_CLEAN
  FROM (      
--
SELECT PON, CAST(MIN(CREATIONDATETIME) AS DATE) FIRST_CONF_DT
FROM WHSL_ADV_HIST.VFO_ORDERHISTORYINFO_THIST ORD
WHERE ORDERSTATUS IN ('Confirmed_Submitted','Confirmed_Sent')
AND PON IN (
'7WSC3858790',
'7WSC3858803',
'HWSV4483627',
'HWSV4483641',
'OF32150836E1N',
'HWSC3866515',
'7WSC3854309',
'7WSC3861855',
'HWSC3871324',
'GWS03873879',
'28091015-TSP',
'OF33766520E1U',
'OF33767313E2U',
'OF33767313E2UA',
'OF33952784E1',
'OF33766520E1UA',
'HWSV4525777',
'7WSC3877231',
'HWSC3877673',
'OF34200490E2U',
'OF34200490E1U',
'OF34203478E2',
'OF34203478E1',
'OF34201599E1U',
'OF34201599E2U'
) 
GROUP BY PON
) SUBQ1,
--
  WHSL_ADV_HIST.VFO_ORDERHISTORYINFO_THIST VFO2
  WHERE SUBQ1.PON = VFO2.PON
  AND VFO2.CREATIONDATETIME < SUBQ1.FIRST_CONF_DT
  AND VFO2.ORDERSTATUS = 'Accepted_Submitted'
  GROUP BY SUBQ1.PON
)
--
UNION ALL
--
SELECT PON, NULL INIT_AS, NULL FIRST_CLEAN, NULL CLEAN_AS, MIN(DT) INIT_CONF, MAX(DT) CLEAN_CONF, NULL INIT_DLR, NULL CLEAN_DLR
FROM (
SELECT PON, VERSION, ORDERSTATUS, TRUNC(CREATIONDATETIME) DT
FROM WHSL_ADV_HIST.VFO_ORDERHISTORYINFO_THIST ORD
WHERE PON IN (
'7WS03855410'
)
AND ORDERSTATUS IN ('Confirmed_Submitted','Confirmed_Sent')
)
GROUP BY PON
--
UNION ALL
--
SELECT PON, NULL INIT_AS, NULL FIRST_CLEAN, NULL CLEAN_AS, NULL INIT_CONF, NULL CLEAN_CONF, MIN(DT) INIT_DLR, MAX(DT) CLEAN_DLR
FROM (
SELECT PON, VERSION, ORDERSTATUS, TRUNC(CREATIONDATETIME) DT
FROM WHSL_ADV_HIST.VFO_ORDERHISTORYINFO_THIST ORD
WHERE PON IN (
'7WS03855410'
)
AND ORDERSTATUS IN ('DLR_Submitted','DLR_Sent')
--
)
GROUP BY PON
)
GROUP BY PON;

